<!DOCTYPE html>
<html>
<head>
  <title>AWS SDK for JavaScript - Sample Application</title>
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.12.min.js"></script>
</head>
<body>
  <div id="fb-root"></div>
  <script type="text/javascript">
    var appId = '123458888217786';
    var roleArn = 'arn:aws:iam::382937512871:role/drive-it-fb-login-role';
    var fbUserId;

    /*!
     * Login to your application using Facebook.
     * Uses the Facebook SDK for JavaScript available here:
     * https://developers.facebook.com/docs/javascript/gettingstarted/
     */
    window.fbAsyncInit = function () {
      FB.init({
        appId: appId
      });
      FB.getLoginStatus(function(response) {
        console.log(response);
      });
      FB.login(function (response) {
        console.log(response);
        AWS.config.credentials = new AWS.WebIdentityCredentials({
          ProviderId: 'graph.facebook.com',
          RoleArn: roleArn,
          WebIdentityToken: response.authResponse.accessToken
        });
        fbUserId = response.authResponse.userID;


        AWS.config.credentials.get(function(err) {
          if (err) {
            console.log("Error: "+err);
            return;
          }
          console.log("Cognito Identity Id: " + AWS.config.credentials.identityId);

          // Other service clients will automatically use the Cognito Credentials provider
          // configured in the JavaScript SDK.
          var cognitoSyncClient = new AWS.CognitoSync();
          cognitoSyncClient.listDatasets({
            IdentityId: AWS.config.credentials.identityId,
            IdentityPoolId: "YOUR_COGNITO_IDENTITY_POOL_ID"
          }, function(err, data) {
            if ( !err ) {
              console.log(JSON.stringify(data));
            }
          });
        });
      });
    };
     // Load the Facebook SDK asynchronously
    (function (d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) {
        return;
      }
      js = d.createElement(s);
      js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>
  </body>
</html